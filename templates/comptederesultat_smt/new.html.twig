{% extends 'base.html.twig' %}
{% block stylesheets %}
    <link href="{{ asset('admin/dist/assets/libs/sweetalert2/sweetalert2.min.css')}}" rel="stylesheet" type="text/css" />
    <!-- Responsive Table css -->
    <link href="{{ asset('admin/dist/assets/libs/admin-resources/rwd-table/rwd-table.min.css')}}" rel="stylesheet" type="text/css" />


{% endblock %}


{% block body %}

        <!-- start page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box d-sm-flex align-items-center justify-content " style="font-size:8px;">
                <div class=" p-2">
                    <a href="{{ path('app_bilan_smt_new') }}" class="btn btn-secondary waves-effect waves-light btn-sm">Bilan smt<i class="mdi mdi-arrow-right ms-1"></i></a>
                </div>
                <div class=" p-2">
                    <a href="{{ path('app_comptederesultat_smt_new') }}" class="btn btn-primary waves-effect waves-light btn-sm">Compte résultat smt<i class="mdi mdi-arrow-right ms-1"></i></a>
                </div>
                <div class=" p-2">
                {#
                    <a href="{{path('app_suivi_materiel_mobiliers_new')}}" class="btn btn-secondary waves-effect waves-light btn-sm">{{'SUIVI DU MATERIEL, DU MOBILIER ET DES CAUTIONS' | lower | capitalize }}<i class="mdi mdi-arrow-right ms-1"></i></a>
                #}
                </div>
                <div class=" p-2">
                {#
                    <a href=" {{path('app_etat_des_stocks_smt_new')}} " class="btn btn-secondary waves-effect waves-light btn-sm">{{'ETAT DES STOCKS' | lower | capitalize }} <i class="mdi mdi-arrow-right ms-1"></i></a>
                #}
                </div>
                <div class=" p-2">
                {#
                    <a href=" {{path('app_dettes_creances_smt_new')}} " class="btn btn-secondary waves-effect waves-light btn-sm">{{'ETAT DES CREANCES ET DES DETTES NON ECHUES' | lower | capitalize}}<i class="mdi mdi-arrow-right ms-1"></i></a>
                #}
                </div>
                <div class=" p-2">
                {#
                    <a href="{{path('app_journal_tresorerie_new')}}" class="btn btn-secondary waves-effect waves-light btn-sm">Journal de trésorerie <i class="mdi mdi-arrow-right ms-1"></i></a>
                #}
                </div>
                <div class=" p-2">
                {#
                    <a href="{{path('app_journal_creances_impayees_smt_new')}}" class="btn btn-secondary waves-effect waves-light btn-sm">Journal de suivi des créances <i class="mdi mdi-arrow-right ms-1"></i></a>
                #}
                </div>
                <div class=" p-2">
                {#
                    <a href="{{path('app_journal_dettes_payer_smt_new')}}" class="btn btn-secondary waves-effect waves-light btn-sm">Journal de suivi des dettees à payer <i class="mdi mdi-arrow-right ms-1"></i></a>
                #}
                </div>
            </div>
        </div>
         <span style="font-size:14px; color:#60b9c7;border-bottom: 1px solid #60b9c7; width:100%;" >Compte de résultat smt</span>
    </div>
        <!-- end page title -->

 <br>
<div class="row">
    <div class="col-xl-12">

        <!-- debut form -->
<div class="card" style=" margin: 0%;padding: 0%;-webkit-box-shadow:0 1rem 3rem rgba(0,0,0,.175);box-shadow:0 1rem 3rem rgba(0,0,0,.175)">
    <form method="post" action="{{path('app_comptederesultat_smt_new')}}" id="idformcompte" name="idformcompte">
    <div class="card-body " style="margin: 0%;padding: 0%;">
        <div class="row">
        <div class="col-xl-12"> 

        
            <table class="table table-bordered " style="margin-top: 0px; padding: 0px;">
                <tr style="margin-top:0px;">
                    <td  style="width: 15%;">Numéro d'identification :<span style="color:red">*</span></td><td style="width: 10%;">
                        <input type="text"  readonly class="form-control form-control-sm" name="codecuci" id="idcuci" ></td>
                    <td style="text-align: right; width: 15%;">Désignation entité :<span style="color:red">*</span></td><td  style="width: 20%;">
                        <input type="text" disabled class="form-control form-control-sm" name="denomination" id="denomination"></td>
                    <td style="text-align: right; width: 10%;">Année financière :<span style="color:red">*</span></td><td  style="width: 5%;">
                     <input readonly type="text" class="form-control form-control-sm input-mask" name="annee" id="annee"  data-inputmask="'mask': '9999'"></td>
                </tr>
            </table>
         
             <div class="card">
                 <div class="card-body">

                     <div class="d-flex flex-wrap gap-2 justify-content-center">
                         <button type="reset" class="btn btn-secondary waves-effect waves-light resetBtn" id="resetBtn">
                             <i class="bx bx-error font-size-16 align-middle me-2"></i> Effacer les données
                         </button>
                         <button type="button" class="btn btn-success waves-effect waves-light sauvegarde">
                             <i class="bx bx-check-double font-size-16 align-middle me-2"></i> Sauvegarder
                         </button>
                         {#<button type="button" class="btn btn-dark bg-soft opacity-25" name="valider" id="valider">#}
                         <button type="button" class="btn btn-dark bt-soft waves-effect waves-light validerComptesmt" id="valider">
                             <i class="bx bx-block font-size-16 align-middle me-2"></i> Valider la saisie
                         </button>
                        <input name="submited" id="submited" type="submit" value="1" style="display:none;"/>
                        <input name="notsubmited" id="notsubmited" type="submit" value="0" style="display:none;"/>
                 </div>
             </div>
         </div>

         <div class="col-12">
            <div class="table-responsive">
                <table name="form2" id="form2" class="table table-bordered table-striped">
                    <thead style="color: white;">
                        <!---<tr class=" opacity-65" style="background: #008000;">
                            <th scope="col" colspan="2" class="text-center ">
                            </th>
                            <th scope="col" colspan="3" class="text-center">
                            </th>
                            <th colspan="3" scope="col" class="text-center text-white">
                              Exercice au 31/12/<span class="text" id="anneeN"></span> 
                            </th>
                            <th colspan="3" scope="col" class="text-center text-white">
                              Exercice au 31/12/<span class="text" id="anneeN-1"></span>
                            </th>
                        </tr>-->
                        
                        <!-- t header remplacer -->
                        <tr class=" opacity-65" style="background: #008000;">
                            <th scope="col" colspan="3" class="text-center " style="width: 30%;">
                                <span style="color:orange; font-size:10px;">Numéro d'identification : </span><span style="color:orange; font-size:10px;" id="txtcuci-cr"></span> 
                            </th>
                            <th colspan="4" scope="col" class="text-center " style="width: 35%;">
                                
                                  <span style="color:orange; font-size:10px;">Désignation entité : </span><span style="color:orange; font-size:10px;" id="txtdesignation-cr"></span>  
                            </th>
                            <th colspan="3" scope="col" class="text-center " style="width: 35%;">
                                 <span style="color:orange; font-size:10px;">Année financière : </span><span style="color:orange; font-size:10px;" id="txtfinanciere-cr"></span>
                            </th>
                            
                        </tr>
                        <!-- t header remplacer -->

                        <tr class=" opacity-80" style="background: #008000;">
                            <th scope="col" colspan="2" rowspan="2" class="text-center text-white">
                                REF
                            </th>
                            <th scope="col" colspan="" rowspan="6" class="text-center text-white">
                                Libelle
                            </th>
                            

                            <th colspan="3" scope="col" class="text-center text-white">
                              Exercice au 31/12/<span class="text" id="anneeN"></span> 
                            </th>
                            <th colspan="3" scope="col" class="text-center text-white">
                              Exercice au 31/12/<span class="text" id="anneeN-1"></span>
                            </th>
                        </tr>
                        <tr class=" opacity-80" style="background: #008000;">
                            <th colspan="4" scope="col" class="text-center text-white">
                              NET1
                            </th>
                            <th colspan="2" scope="col" class="text-center text-white">
                              NET2
                            </th>
                        </tr>
                    </thead>

                    <!-- debut tbody inputs -->
                    <tbody id="tbody">
                
                    
                    
                    </tbody>
                    <!-- end tbody -->
                </table> </br>
            </div>
        </div>
        
        
        
    </div>
    <div class="d-flex flex-wrap gap-2 justify-content-center">
       <button type="reset" class="btn btn-secondary waves-effect waves-light resetBtn" id="resetBtn2">
           <i class="bx bx-error font-size-16 align-middle me-2"></i> Effacer les données
       </button>
       <button type="button" class="btn btn-success waves-effect waves-light sauvegarde">
           <i class="bx bx-check-double font-size-16 align-middle me-2"></i> Sauvegarder
       </button>
       <button type="button" class="btn btn-dark bt-soft waves-effect waves-light validerComptesmt"
        id="valider2">
           <i class="bx bx-block font-size-16 align-middle me-2"></i> Valider la saisie
       </button>
   </div>
            <!-- <input type="hidden" name="type" value="1" >
            <button type="submit" class="btn btn-success waves-effect waves-light">
                <i class="bx bx-check-double font-size-16 align-middle me-2"></i> Sauvegarder
            </button> -->
                         
        </div>
        <input type="hidden" name="" value="2" >
        </form>
</div>

<!-- end formulaire -->

</div>
</div>


{% endblock %}


{% block javascript %}
<script src="{{ asset('admin/dist/assets/libs/sweetalert2/sweetalert2.min.js')}}"></script>

  <!-- Sweet alert init js-->
<script src="{{ asset('admin/dist/assets/js/pages/sweet-alerts.init.js')}}"></script>

<script src="{{ asset('admin/dist/assets/libs/admin-resources/rwd-table/rwd-table.min.js')}}"></script>

        <!-- Init js -->


        <!-- form mask init -->
<script src="{{ asset('admin/dist/assets/js/pages/form-mask.init.js')}}"></script>
<script src="{{ asset('admin/dist/assets/libs/inputmask/min/jquery.inputmask.bundle.min.js')}}"></script>

<script type="text/javascript">


 $(document).ready(function(){

    {% if app.session.get("codeCuci")!=""%}
     
       var value='{{app.session.get("codeCuci")}}';
   
       document.getElementById('idcuci').setAttribute('value',value);
       document.getElementById('txtcuci-cr').innerHTML=value;


       //let route="{{path('nineaNum')}}"+"/"+ value;
       let route="{{path('nineaNum')}}"+"/"+ $('#idcuci').val();
               $.ajax({
                   type: 'GET',
                   url : route,
                   dataType : "json",
                   success: function(data){
                       
                       let denomination=document.getElementById("denomination");
                       document.getElementById('txtdesignation-cr').innerHTML=data;
                       denomination.value=data;
   
                     
                   } ,
                   error : function(error){
                       console.log(error);
                   }
       })


       {% if app.session.get("annee")!=""%}

            document.getElementById('txtfinanciere-cr').innerHTML='{{app.session.get("annee")}}';

            document.getElementById("annee").value='{{app.session.get("annee")}}';
            let routeurl="{{path('smtCPjson')}}"+"/"+ '{{app.session.get("annee")}}';
            var form = $(this).closest("form");

            $.ajax({
                type: 'GET',
                url : routeurl,
                dataType : "json",
                processData: false,
                contentType: false,
                cache: false,
                timeout: 800000,
                success: function(data){
                   console.log(data);
                    var tbody=document.getElementById("tbody");
                    var ann=document.getElementById("annee");
                    var anneeN_1=document.getElementById("anneeN-1");
                    var anneeN=document.getElementById("anneeN");
                    tbody.innerHTML="";
                    ann.innerHTML="";
                    anneeN.value = ann.value;
                    anneeN.setAttribute('value', anneeN.value);
                    anneeN.innerHTML=anneeN.value;
                    anneeN_1.innerHTML=anneeN.value-1;
                        
                          //for (var j = data[1].length - 1; j >= 0; j--) {
                          for (var j = 0; j < data[1].length; j++) {
          
                                  var tr=document.createElement('tr'); // tr pour les agregats fils
                                

                                  if( data[1][j][3]==true){
                                    tr.setAttribute('style',"background: #82C46C;color:white;border:#ced4da;");
                                  }else 
                                     tr.setAttribute('style',"border:#ced4da;");

                                  var td1=document.createElement('td');
                                  var td2=document.createElement('td');
          
                                  var td5=document.createElement('td');
                                  var td6=document.createElement('td');
    
                                  var tsignes = document.createElement('td');
                                  var tnotes = document.createElement('td');
    
    
          
                                  td1.setAttribute('colspan',2); 
                                  td1.setAttribute('scope',"col"); 
                                  td1.setAttribute('class',"text-center form");  
                                         
                                  td1.innerHTML=  data[1][j][0];
                                  tr.appendChild(td1) ;
                                  
                                  td2.setAttribute('colspan',1); 
                                  td2.setAttribute('class',"text-left form");           
                                  td2.setAttribute('scope',"col"); 
                                            
                                  td2.innerHTML=  data[1][j][1];
                                  tr.appendChild(td2) ;
    
                                  
                                  td5.setAttribute('colspan',3); 
                                  td5.setAttribute('scope',"col"); 
                                  td5.setAttribute('class',"text-center");
                                  var input5=document.createElement('input');
                                  input5.setAttribute('type','text'); 
                                  input5.setAttribute('name',data[1][j][0]+"net1"); 
                                  input5.setAttribute('id',data[1][j][0]+"net1"); 
                                  input5.setAttribute('class','form-control form-control-sm calcul net1 '+data[1][j][2]); 
                                  input5.setAttribute('data-sousclasse',data[1][j][2]);

                                  input5.setAttribute('oninput',"this.value = this.value.replace(/[^0-9,-]/g, '');"); 
                                 
                                  if(data[0][data[1][j][0]]){
                                      input5.setAttribute('value',data[0][data[1][j][0]][1]);
                                  }
          
                                  td5.appendChild(input5);
                                  tr.appendChild(td5) ;
                                  td6.setAttribute('colspan',3); 
                                  td6.setAttribute('scope',"col"); 
                                  td6.setAttribute('class',"text-center");           
                                  var input6=document.createElement('input');  
                                  input6.setAttribute('class','form-control form-control-sm calcul net2 '+data[1][j][2]); 
                                  input6.setAttribute('type','text'); 
                                  input6.setAttribute('name',data[1][j][0]+"net2"); 
                                  input6.setAttribute('id',data[1][j][0]+"net2"); 
                                  input6.setAttribute('data-sousclasse',data[1][j][2]);
                                  input6.setAttribute('oninput',"this.value = this.value.replace(/[^0-9,-]/g, '');"); 

                                  if(data[0][data[1][j][0]]){
                                  input6.setAttribute('value',data[0][data[1][j][0]][2]);
                                  }
                                  td6.appendChild(input6);
                                  tr.appendChild(td6) ;
                                  tbody.appendChild(tr);  
                          } 
                    
                          $(".form-control").bind("keypress", function(e) {
                    
                                if (e.keyCode == 13) {
                                    var inps = $("input"); //add select too
                                    for (var x = 0; x < inps.length; x++) {
                                        if (inps[x] == this) {
                                            while ((inps[x]).name == (inps[x + 1]).name) {
                                            x++;
                                            }
                                            if ((x + 1) < inps.length) $(inps[x + 1]).focus();
                                        }
                                    }   e.preventDefault();
                                }
                          });

                        $(function(){
                                    $(".table-responsive").responsiveTable({addDisplayAllBtn:"btn btn-secondary"}),
                                    $(".btn-toolbar [data-toggle=dropdown]").attr("data-bs-toggle","dropdown")});
                
                            
                            } ,
                            error : function(error){
                                console.log(error);
                            }
            })
        
       {% endif %}
   
    {% endif %}
   
});


    //$(document).ready(function(){

        $('#idcuci').change(function(){
            
            let route="{{path('nineaNum')}}"+"/"+ $('#idcuci').val();
            document.getElementById('txtcuci-cr').innerHTML=$('#idcuci').val();
            $.ajax({
                type: 'GET',
                url : route,
                dataType : "json",
                processData: false,
                contentType: false,
                cache: false,
                timeout: 800000,
                success: function(data){
                    
                    let denomination=document.getElementById("denomination");
                    denomination.value=data;
                    //// ici recuperer l'annee de session
                    document.getElementById("annee").value=$('#annee').val();

                    document.getElementById('txtdesignation-cr').innerHTML=data;


                    
                    
                } ,
                error : function(error){
                    console.log(error);
                }
            })
        });


        
    $('#annee').change(function(e){

        e.preventDefault();

        let route="{{path('smtCPjson')}}"+"/"+ $('#annee').val(); //console.log(route);
        document.getElementById("txtfinanciere-cr").innerHTML=$('#annee').val();
            
       $.ajax({
                type: 'GET',
                url : routeurl,
                dataType : "json",
                processData: false,
                contentType: false,
                cache: false,
                timeout: 800000,
                success: function(data){
                   console.log(data);
                    var tbody=document.getElementById("tbody");
                    var ann=document.getElementById("annee");
                    var anneeN_1=document.getElementById("anneeN-1");
                    var anneeN=document.getElementById("anneeN");
                    tbody.innerHTML="";
                    ann.innerHTML="";
                    anneeN.value = ann.value;
                    anneeN.setAttribute('value', anneeN.value);
                    anneeN.innerHTML=anneeN.value;
                    anneeN_1.innerHTML=anneeN.value-1;
                        
                          //for (var j = data[1].length - 1; j >= 0; j--) {
                          for (var j = 0; j < data[1].length; j++) {
          
                                  var tr=document.createElement('tr'); // tr pour les agregats fils
                                

                                  if( data[1][j][3]==true){
                                    tr.setAttribute('style',"background: #82C46C;color:white;border:#ced4da;");
                                  }else 
                                     tr.setAttribute('style',"border:#ced4da;");

                                  var td1=document.createElement('td');
                                  var td2=document.createElement('td');
          
                                  var td5=document.createElement('td');
                                  var td6=document.createElement('td');
    
                                  var tsignes = document.createElement('td');
                                  var tnotes = document.createElement('td');
    
    
          
                                  td1.setAttribute('colspan',2); 
                                  td1.setAttribute('scope',"col"); 
                                  td1.setAttribute('class',"text-center form");  
                                         
                                  td1.innerHTML=  data[1][j][0];
                                  tr.appendChild(td1) ;
                                  
                                  td2.setAttribute('colspan',1); 
                                  td2.setAttribute('class',"text-left form");           
                                  td2.setAttribute('scope',"col"); 
                                            
                                  td2.innerHTML=  data[1][j][1];
                                  tr.appendChild(td2) ;
    
                                  
                                  td5.setAttribute('colspan',3); 
                                  td5.setAttribute('scope',"col"); 
                                  td5.setAttribute('class',"text-center");
                                  var input5=document.createElement('input');
                                 if( data[1][j][3]==true)
                                      input5.setAttribute('style','font-weight: bold;');
                                  input5.setAttribute('type','text'); 
                                  input5.setAttribute('name',data[1][j][0]+"net1"); 
                                  input5.setAttribute('id',data[1][j][0]+"net1"); 
                                  input5.setAttribute('class','form-control form-control-sm calcul net1 '+data[1][j][2]); 
                                  input5.setAttribute('data-sousclasse',data[1][j][2]);

                                  input5.setAttribute('oninput',"this.value = this.value.replace(/[^0-9,-]/g, '');"); 
                                 
                                  if(data[0][data[1][j][0]]){
                                      input5.setAttribute('value',data[0][data[1][j][0]][1]);
                                  }
          
                                  td5.appendChild(input5);
                                  tr.appendChild(td5) ;
                                  td6.setAttribute('colspan',3); 
                                  td6.setAttribute('scope',"col"); 
                                  td6.setAttribute('class',"text-center");           
                                  var input6=document.createElement('input');  
                                  input6.setAttribute('class','form-control form-control-sm calcul net2 '+data[1][j][2]); 
                                  input6.setAttribute('type','text'); 
                                   if( data[1][j][3]==true)
                                      input6.setAttribute('style','font-weight: bold;');
                                  input6.setAttribute('name',data[1][j][0]+"net2"); 
                                  input6.setAttribute('id',data[1][j][0]+"net2"); 
                                  input6.setAttribute('data-sousclasse',data[1][j][2]);
                                  input6.setAttribute('oninput',"this.value = this.value.replace(/[^0-9,-]/g, '');"); 

                                  if(data[0][data[1][j][0]]){
                                  input6.setAttribute('value',data[0][data[1][j][0]][2]);
                                  }
                                  td6.appendChild(input6);
                                  tr.appendChild(td6) ;
                                  tbody.appendChild(tr);  
                          } 
                    
                          $(".form-control").bind("keypress", function(e) {
                    
                                if (e.keyCode == 13) {
                                    var inps = $("input"); //add select too
                                    for (var x = 0; x < inps.length; x++) {
                                        if (inps[x] == this) {
                                            while ((inps[x]).name == (inps[x + 1]).name) {
                                            x++;
                                            }
                                            if ((x + 1) < inps.length) $(inps[x + 1]).focus();
                                        }
                                    }   e.preventDefault();
                                }
                          });

                        $(function(){
                                    $(".table-responsive").responsiveTable({addDisplayAllBtn:"btn btn-secondary"}),
                                    $(".btn-toolbar [data-toggle=dropdown]").attr("data-bs-toggle","dropdown")});
                
                            
                            } ,
                            error : function(error){
                                console.log(error);
                            }
            })
    });

    
    
    function remplacer(vartester){
         
         
        if(vartester == "" || vartester == null){
            return 0;

        }
        vartester=vartester.replace(".", "");
        vartester=vartester.replace(".", "");
        vartester=vartester.replace(".", "");
        vartester=vartester.replace(".", "");
        vartester=vartester.replace(".", "");
        vartester=vartester.replace(".", "");
        vartester=vartester.replace(",", "");
        vartester=vartester.replace(",", "");
        vartester=vartester.replace(",", "");
        vartester=vartester.replace(",", "");
        vartester=vartester.replace(",", "");
        vartester=vartester.replace(",", "");
        vartester=vartester.replace(",", "");
        
        return vartester;
    }

 
 $('.sauvegarde').click(function(){

                var empt = 1;
                var checkboxList = document.getElementsByClassName('calcul');
                for (i = 0; i < checkboxList.length; i++) {
                    if (checkboxList[i].value != "") {
                        console.log(checkboxList[i].value);
                        empt = 0;
                    }
                }
               
                if(empt!=1)
                {
                
                    Swal.fire({
                    title:"Confirmation",
                    text:"Êtes-vous sûr de vouloir sauvegarder  sans valider ?",
                    icon:"warning",
                    showCancelButton:true,
                    confirmButtonText:"Oui",
                    cancelButtonText:"Non",
                    confirmButtonClass:"btn btn-success mt-2",
                    cancelButtonClass:"btn btn-danger ms-2 mt-2",
                    buttonsStyling:!1}).then(function(t)
                    {
                    if (t.value) {
                        document.getElementById("notsubmited").click()
                    }
                    })
                }
 })



    // javascript function to verify integer value is
    function isInt(valeur) {

      if(valeur!=null || valeur!=""){
        var $val=remplacer(valeur);
       
      if((parseFloat($val) == parseFloat($val)) && !isNaN($val)){ 
       
          return true;
      } else {
          
          return false;
      }
      }else 
          return false;
        

        // return !isNaN(value) && 
        //        parseFloat(Number(value)) == value ;
    }


    function getResult(a1, a2) {
        var i = a1.length;
        if (i != a2.length) return false;
     
        while (i--) {
          if (a1[i] !== a2[i]) return false;
        }
        return true;
    }


    $('#tbody').on('change', "#13net1", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("10net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("10net1").value));
        }

        if(isInt(document.getElementById("12net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("12net1").value));
        }

        if(isInt(document.getElementById("13net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("13net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DES RECETTES SUR PRODUITS NET1 !' +somme); return;
        
        }else{
        
        } 

    });

    


    $('#tbody').on('change', "#13net2", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("10net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("10net2").value));
        }

        if(isInt(document.getElementById("12net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("12net2").value));
        }

        if(isInt(document.getElementById("13net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("13net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DES RECETTES SUR PRODUITS NET2 ! '+somme); return;
        
        }else{
        
        } 

    });

    $('#tbody').on('change', "#20net1", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("14net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("14net1").value));
        }

        if(isInt(document.getElementById("15net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("15net1").value));
        }

        if(isInt(document.getElementById("16net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("16net1").value));
        }

        if(isInt(document.getElementById("17net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("17net1").value));
        }

        if(isInt(document.getElementById("18net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("18net1").value));
        }

        if(isInt(document.getElementById("19net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("19net1").value));
        }

        if(isInt(document.getElementById("20net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("20net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DEPENSES SUR CHARGES NET1 ! ' + somme); return;
        
        }else{
        
        } 

    });

    $('#tbody').on('change', "#20net2", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("14net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("14net2").value));
        }

        if(isInt(document.getElementById("15net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("15net2").value));
        }

        if(isInt(document.getElementById("16net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("16net2").value));
        }

        if(isInt(document.getElementById("17net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("17net2").value));
        }

        if(isInt(document.getElementById("18net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("18net2").value));
        }

        if(isInt(document.getElementById("19net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("19net2").value));
        }

        if(isInt(document.getElementById("20net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("20net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DEPENSES SUR CHARGES NET2 ! '+somme); return;
        
        }else{
        
        } 

    });

    $('#tbody').on('change', "#27net2", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("20net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("20net2").value));
        }

        if(isInt(document.getElementById("25net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("25net2").value));
        }


         if(isInt(document.getElementById("26net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("26net2").value));
        }

        if(isInt(document.getElementById("27net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("27net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL GENERAL DES CHARGES NET2 ! '+somme); return;
        
        }else{
        
        } 

    });

     $('#tbody').on('change', "#27net1", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("20net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("20net1").value));
        }

        if(isInt(document.getElementById("25net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("25net1").value));
        }

         if(isInt(document.getElementById("26net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("26net1").value));
        }

        if(isInt(document.getElementById("27net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("27net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL GENERAL DES CHARGES NET1 ! '+somme); return;
        
        }else{
        
        } 

    });


     $('#tbody').on('change', "#21net2", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("13net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net2").value));
        }

        if(isInt(document.getElementById("20net2").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("20net2").value)));
        }


         

        if(isInt(document.getElementById("21net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("21net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour le SOLDE NET2 ! '+somme); return;
        
        }else{
        
        } 

    });

    $('#tbody').on('change', "#21net1", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("13net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net1").value));
        }

        if(isInt(document.getElementById("20net1").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("20net1").value)));
        }


         

        if(isInt(document.getElementById("21net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("21net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour le SOLDE NET1 ! '+somme); return;
        
        }else{
        
        } 

    });



     $('#tbody').on('change', "#28net2", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("13net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net2").value));
        }

        if(isInt(document.getElementById("27net2").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("27net2").value)));
        }


         

        if(isInt(document.getElementById("28net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("28net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour le RESULTAT DE L EXERCICE NET2 ! '+somme); return;
        
        }else{
        
        } 

    });

    $('#tbody').on('change', "#28net1", function(){
        var somme=0, net=0;
        if(isInt(document.getElementById("13net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net1").value));
        }

        if(isInt(document.getElementById("27net1").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("27net1").value)));
        }


         

        if(isInt(document.getElementById("28net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("28net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour  le RESULTAT DE L EXERCICE NET1 ! '+somme); return;
        
        }else{
        
        } 

    });




    $('.validerComptesmt').click(function(e){

        e.preventDefault();
        var swalMsg = "Verifier les valeurs NET saisie pour ";
        var tagnet,net=0,somme=0, valider=1;


        // traitement validation colonne NET1
        var somme=0, net=0;
        if(isInt(document.getElementById("10net1").value)==true){
            somme=somme+parseFloat(remplacer(document.getElementById("10net1").value));
        }

        if(isInt(document.getElementById("12net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("12net1").value));
        }

        if(isInt(document.getElementById("13net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("13net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DES RECETTES SUR PRODUITS NET1 !'+somme); return;
        
        }


         var somme=0, net=0;
        if(isInt(document.getElementById("13net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net2").value));
        }

        if(isInt(document.getElementById("27net2").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("27net2").value)));
        }


         

        if(isInt(document.getElementById("28net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("28net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour le RESULTAT DE L EXERCICE NET2 ! '+somme); return;
        
        }else{
        
        } 


        var somme=0, net=0;
        if(isInt(document.getElementById("13net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net1").value));
        }

        if(isInt(document.getElementById("27net1").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("27net1").value)));
        }


         

        if(isInt(document.getElementById("28net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("28net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour  le RESULTAT DE L EXERCICE NET1 ! '+somme); return;
        
        }else{
        
        } 


       var somme=0, net=0;
        if(isInt(document.getElementById("10net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("10net2").value));
        }

        if(isInt(document.getElementById("12net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("12net2").value));
        }

        if(isInt(document.getElementById("13net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("13net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DES RECETTES SUR PRODUITS NET2 ! '+somme); return;
        
        }else{
        
        } 
        


        var somme=0, net=0;
        if(isInt(document.getElementById("13net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("13net1").value));
        }

        if(isInt(document.getElementById("20net1").value)==true){
           somme=somme- Math.abs(parseFloat(remplacer(document.getElementById("20net1").value)));
        }


         

        if(isInt(document.getElementById("21net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("21net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour le SOLDE NET1 ! '+somme); return;
        
        }else{
        
        } 





        ///NET2 valisation
        var somme=0, net=0;
        if(isInt(document.getElementById("10net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("10net2").value));
        }

        if(isInt(document.getElementById("12net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("12net2").value));
        }

        if(isInt(document.getElementById("13net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("13net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DES RECETTES SUR PRODUITS NET2 !' + somme); return;
        
        }


        var somme=0, net=0;
        if(isInt(document.getElementById("14net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("14net1").value));
        }

        if(isInt(document.getElementById("15net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("15net1").value));
        }

        if(isInt(document.getElementById("16net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("16net1").value));
        }

        if(isInt(document.getElementById("17net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("17net1").value));
        }

        if(isInt(document.getElementById("18net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("18net1").value));
        }

        if(isInt(document.getElementById("19net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("19net1").value));
        }

        if(isInt(document.getElementById("20net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("20net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DEPENSES SUR CHARGES NET1 ! '+somme); return;
        
        }




        var somme=0, net=0;
        if(isInt(document.getElementById("14net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("14net2").value));
        }

        if(isInt(document.getElementById("15net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("15net2").value));
        }

        if(isInt(document.getElementById("16net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("16net2").value));
        }

        if(isInt(document.getElementById("17net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("17net2").value));
        }

        if(isInt(document.getElementById("18net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("18net2").value));
        }

        if(isInt(document.getElementById("19net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("19net2").value));
        }

        if(isInt(document.getElementById("20net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("20net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL DEPENSES SUR CHARGES NET2 ! '+somme); return;
        
        }




        var somme=0, net=0;
        if(isInt(document.getElementById("20net2").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("20net2").value));
        }

        if(isInt(document.getElementById("25net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("25net2").value));
        }
          if(isInt(document.getElementById("26net2").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("26net2").value));
        }

        if(isInt(document.getElementById("27net2").value)==true){
            net=parseFloat(remplacer(document.getElementById("27net2").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL GENERAL DES CHARGES NET2 ! '+somme); return;
        
        }




        var somme=0, net=0;
        if(isInt(document.getElementById("20net1").value)==true){
        somme=somme+parseFloat(remplacer(document.getElementById("20net1").value));
        }

        if(isInt(document.getElementById("25net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("25net1").value));
        }

        if(isInt(document.getElementById("26net1").value)==true){
           somme=somme+parseFloat(remplacer(document.getElementById("26net1").value));
        }

        if(isInt(document.getElementById("27net1").value)==true){
            net=parseFloat(remplacer(document.getElementById("27net1").value));
        } else net=0;
       
        if (somme!=net) {
            valider=0;
            Swal.fire('Vérifier les valeurs saisies pour TOTAL GENERAL DES CHARGES NET1 ! '+somme); return;
        
        }




        if (valider==1) {

            var empt = 1;
                var checkboxList = document.getElementsByClassName('calcul');
                for (i = 0; i < checkboxList.length; i++) {
                    if (checkboxList[i].value != "") {
                        console.log(checkboxList[i].value);
                        empt = 0;
                    }
                }
               
                if(empt!=1)
                {

                    //TODO check compare Resultat des exercies 

                    // un tab contenant les valeurs de XIn et XIn-1
                    var XInet1 = (isInt(document.getElementById("28net1").value)) ? parseInt(remplacer(document.getElementById("28net1").value)) : 0;
                    var XInet2 = (isInt(document.getElementById("28net2").value)) ? parseInt(remplacer(document.getElementById("28net2").value)) : 0;
                    var xin=[
                        XInet1
                    ];
                    var xin2=[
                        XInet2
                    ];
                        //uz2
           
                     
                    let routeResult="{{path('compareResultatExercices')}}"+"/"+ $('#annee').val();

                     $.ajax({
                            type: 'GET',
                            url : routeResult,
                            dataType : "json",
                            processData: false,
                            contentType: false,
                            cache: false,
                            timeout: 800000,
                            success: function(data){ 
                                
                                //if(JSON.stringify(data) === JSON.stringify(xin)){
                                let myArr = [
                                    parseInt(remplacer(data[0][0])),
                                ]; 
                                let myArr2 = [
                                    parseInt(remplacer(data[0][1]))
                                ]; 

                                    //parseInt(remplacer(data[0][1]))                           

                                
                                if(false == getResult(myArr, xin)){
                                    console.log(myArr, xin); 
                                       
                                    valider=0;
                                    Swal.fire('Verifier les valeurs NET1 saisies pour Résultat de exercice , (Résultat net de l\'exercice Passif) doit être égal à \n(Résultat net du Compte) ! '+data[0][0]); return;
                                }
                                else if(false == getResult(myArr2, xin2)){
                                    console.log(myArr2, xin2); 
                                       
                                    valider=0;
                                    Swal.fire('Verifier les valeurs NET2 saisies pour Résultat de exercice, \n (Résultat net de l\'exercice Passif) doit être égal à \n(Résultat net du Compte) ! '+data[0][1]); return;
                                    
                                }else{

                                    
                                    e.preventDefault();
                                    var a=$(this);
                                    Swal.fire({
                                    title:"Confirmation",
                                    text:"Êtes-vous sûr de vouloir sauvegarder les données de cet enrégistrement ?",
                                    icon:"success",
                                    showCancelButton:true,
                                    confirmButtonText:"Oui",
                                    cancelButtonText:"Non",
                                    confirmButtonClass:"btn btn-success mt-2",
                                    cancelButtonClass:"btn btn-danger ms-2 mt-2",
                                    buttonsStyling:!1}).then(function(t)
                                    {
                                    if (t.value) {
                                        document.getElementById("submited").click()
                                    }else
                                        e.preventDefault();

                                    })



                                }
                                                   
                                
                            } ,
                            error : function(error){
                                console.log(error);
                            }
                        });




                }
        }
      
    }); // end eventListner btn valider 

    
    
    $('.resetBtn').click(function(e){
        
        event.preventDefault();
        var checkboxList = document.getElementsByClassName('calcul');
        for (i = 0; i < checkboxList.length; i++) {
            checkboxList[i].value="";
        }

    });    

    
    function somme(netnumber,sousclasseName){
        var elemts =  $('input.calcul.'+netnumber+'.'+sousclasseName);
        var sum =0;
        for(var i = 0 ; i< elemts.length;i++){
            sum+=parseInt(elemts[i].value);
        }

        return sum;

    }

        
   // }); end dom



   
    // Auto Close Bootstrap alerts
    window.setTimeout(function() {
        $(".alert").fadeTo(500, 0).slideUp(500, function(){
            $(this).remove();
        });
    }, 2000);


</script>


{% endblock %}